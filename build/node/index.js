!function(e,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var t=r();for(var n in t)("object"==typeof exports?exports:e)[n]=t[n]}}(global,function(){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)t.d(n,a,function(r){return e[r]}.bind(null,a));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=24)}([function(e,r){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,r){e.exports=require("@babel/runtime/regenerator")},function(e,r){e.exports=require("@babel/runtime/helpers/assertThisInitialized")},function(e,r){e.exports=require("typedarray-to-buffer")},function(e,r){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,r){e.exports=require("libsodium-wrappers")},function(e,r){e.exports=require("bignumber.js")},function(e,r){e.exports=require("@babel/runtime/helpers/classCallCheck")},function(e,r){e.exports=require("@babel/runtime/helpers/createClass")},function(e,r){e.exports=require("bs58check")},function(e,r){e.exports=require("pbkdf2")},function(e,r){e.exports=require("@babel/runtime/helpers/toConsumableArray")},function(e,r){e.exports=require("secp256k1")},function(e,r){e.exports=require("secp256r1")},function(e,r){e.exports=require("buffer/")},function(e,r){e.exports=require("@ledgerhq/hw-transport-node-hid")},function(e,r){e.exports=require("@babel/runtime/helpers/getPrototypeOf")},function(e,r){e.exports=require("bip39")},function(e,r){e.exports=require("@babel/runtime/helpers/slicedToArray")},function(e,r){e.exports=require("@babel/runtime/helpers/possibleConstructorReturn")},function(e,r){e.exports=require("@babel/runtime/helpers/get")},function(e,r){e.exports=require("@babel/runtime/helpers/inherits")},function(e,r){e.exports=require("xhr2")},function(e,r){e.exports=require("blake2b")},function(e,r,t){"use strict";t.r(r);var n,a=t(18),i=t.n(a),o=t(11),c=t.n(o),s=t(1),u=t.n(s),p=t(4),f=t.n(p),l=t(7),d=t.n(l),h=t(8),g=t.n(h),b=t(19),v=t.n(b),y=t(2),k=t.n(y),m=t(16),_=t.n(m),w=t(20),x=t.n(w),A=t(21),E=t.n(A),O=t(0),S=t.n(O),T=t(22),C=t.n(T),P=function(){function e(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"main",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};d()(this,e),S()(this,"_provider",void 0),S()(this,"_network",void 0),S()(this,"_defaultFee",void 0),S()(this,"_chain",void 0),this._provider=r,this._network=n,this._chain=t,this._defaultFee=a.defaultFee||1420}return g()(e,[{key:"setProvider",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.chain,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.network;this._provider=e,this._chain=r,this._network=t}},{key:"provider",get:function(){return this._provider},set:function(e){this._provider=e}},{key:"network",get:function(){return this._network},set:function(e){this._network=e}},{key:"chain",get:function(){return this._chain},set:function(e){this._chain=e}},{key:"defaultFee",get:function(){return this._defaultFee},set:function(e){this._defaultFee=e}}]),e}(),K=t(5),U=t.n(K),B=t(10),I=t.n(B),q=t(12),L=t.n(q),N=t(13),F=t.n(N),j=t(3),M=t.n(j),z=t(9),D=t.n(z),R=t(6),H=t(14),G=function(e){if("number"==typeof e)return e/1e6;if("string"==typeof e)return parseInt(e,10)/1e6;throw new TypeError('Invalid parameter for "mutez" provided.')},Q=function(e){return new R.BigNumber(new R.BigNumber(e).toFixed(6)).multipliedBy(1e6).toString()},V=function e(r){"("===(r=r.replace(/(?:@[a-z_]+)|(?:#.*$)/gm,"").replace(/\s+/g," ").trim()).charAt(0)&&(r=r.slice(1,-1));for(var t=0,n=!1,a=!1,i={prim:"",args:[]},o="",c=0;c<r.length;c++)if(a)o+=r[c],a=!1;else if(c===r.length-1&&!1===n||" "===r[c]&&0===t&&!1===n){if(c===r.length-1&&(o+=r[c]),o){if(o===parseInt(o,10).toString()){if(!i.prim)return{int:o};i.args.push({int:o})}else if("0"===o[0]){if(!i.prim)return{bytes:o};i.args.push({bytes:o})}else i.prim?i.args.push(e(o)):i.prim=o;o=""}}else if('"'===r[c]&&n){if(n=!1,!i.prim)return{string:o};i.args.push({string:o}),o=""}else'"'!==r[c]||n||0!==t?("\\"===r[c]?a=!0:"("===r[c]?t++:")"===r[c]&&t--,o+=r[c]):n=!0;return i},W=function e(r){var t=[];if(Object.prototype.hasOwnProperty.call(r,"prim"))"Pair"===r.prim?(t.push(e(r.args[0])),t=t.concat(e(r.args[1]))):"Elt"===r.prim?t={key:e(r.args[0]),val:e(r.args[1])}:"True"===r.prim?t=!0:"False"===r.prim&&(t=!1);else if(Array.isArray(r))for(var n=r.length,a=0;a<n;a++){var i=e(r[a]);void 0!==i.key?(Array.isArray(t)&&(t={keys:[],vals:[]}),t.keys.push(i.key),t.vals.push(i.val)):t.push(i)}else t=Object.prototype.hasOwnProperty.call(r,"string")?r.string:Object.prototype.hasOwnProperty.call(r,"int")?parseInt(r.int,10):r;return t},Y=function e(r){for(var t=[],n=!1,a="",i="",o=0,c=0,s=!1,u=!1,p=0;p<r.length;p++){if("}"!==i&&";"!==i||(i=""),n){if("}"===r[p]?c--:"{"===r[p]&&c++,0===c){var f=e(i);t.push({prim:a.trim(),args:[f]}),i="",c=0,n=!1}}else{if("{"===r[p]){c++,a=i,i="",n=!0;continue}if(u){i+=r[p],u=!1;continue}if(p===r.length-1&&!1===s||";"===r[p]&&0===o&&!1===s){if(p===r.length-1&&(i+=r[p]),""===i.trim()||"}"===i.trim()||";"===i.trim()){i="";continue}t.push(V(i)),i="";continue}'"'===r[p]&&s?s=!1:'"'!==r[p]||s?"\\"===r[p]?u=!0:"("===r[p]?o++:")"===r[p]&&o--:s=!0}i+=r[p]}return t},J={textEncode:function(e){return new Uint8Array(H.Buffer.from(e,"utf8"))},textDecode:function(e){return H.Buffer.from(e).toString("utf8")},b582int:function(e){for(var r=new R.BigNumber(0),t="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",n=0;n<e.length;n++)r=r.plus(new R.BigNumber(t.indexOf(e[e.length-1-n])).multipliedBy(new R.BigNumber(t.length).exponentiatedBy(n)));return r.toString(16)},totez:G,mutez:Q,b58cencode:function(e,r){var t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),D.a.encode(H.Buffer.from(t,"hex"))},b58cdecode:function(e,r){return D.a.decode(e).slice(r.length)},buf2hex:function(e){var r=new Uint8Array(e),t=[];return r.forEach(function(e){var r=e.toString(16),n="00".concat(r).slice(-2);t.push(n)}),t.join("")},hex2buf:function(e){return new Uint8Array(e.match(/[\da-f]{2}/gi).map(function(e){return parseInt(e,16)}))},hexNonce:function(e){for(var r="";e--;)r+="0123456789abcedf"[16*Math.random()|0];return r},mergebuf:function(e,r){var t=new Uint8Array(e.length+r.length);return t.set(e),t.set(r,e.length),t},sexp2mic:V,mic2arr:W,ml2mic:Y,ml2tzjson:V,tzjson2arr:W,mlraw2json:Y,mintotz:G,tztomin:Q},X={tz1:new Uint8Array([6,161,159]),tz2:new Uint8Array([6,161,161]),tz3:new Uint8Array([6,161,164]),KT:new Uint8Array([2,90,121]),edpk:new Uint8Array([13,15,37,217]),edsk2:new Uint8Array([13,15,58,7]),spsk:new Uint8Array([17,162,224,201]),p2sk:new Uint8Array([16,81,238,189]),sppk:new Uint8Array([3,254,226,86]),p2pk:new Uint8Array([3,178,139,127]),edesk:new Uint8Array([7,90,60,179,41]),edsk:new Uint8Array([43,246,78,7]),edsig:new Uint8Array([9,245,205,134,18]),spsig:new Uint8Array([13,115,101,19,63]),p2sig:new Uint8Array([54,240,44,52]),sig:new Uint8Array([4,130,43]),Net:new Uint8Array([87,82,0]),nce:new Uint8Array([69,220,169]),b:new Uint8Array([1,52]),o:new Uint8Array([5,116]),Lo:new Uint8Array([133,233]),LLo:new Uint8Array([29,159,109]),P:new Uint8Array([2,170]),Co:new Uint8Array([79,179]),id:new Uint8Array([153,103]),TZ:new Uint8Array([2,90,121])},Z={block:new Uint8Array([1]),endorsement:new Uint8Array([2]),generic:new Uint8Array([3])},$={"00":"parameter","01":"storage","02":"code","03":"False","04":"Elt","05":"Left","06":"None","07":"Pair","08":"Right","09":"Some","0A":"True","0B":"Unit","0C":"PACK","0D":"UNPACK","0E":"BLAKE2B","0F":"SHA256",10:"SHA512",11:"ABS",12:"ADD",13:"AMOUNT",14:"AND",15:"BALANCE",16:"CAR",17:"CDR",18:"CHECK_SIGNATURE",19:"COMPARE","1A":"CONCAT","1B":"CONS","1C":"CREATE_ACCOUNT","1D":"CREATE_CONTRACT","1E":"IMPLICIT_ACCOUNT","1F":"DIP",20:"DROP",21:"DUP",22:"EDIV",23:"EMPTY_MAP",24:"EMPTY_SET",25:"EQ",26:"EXEC",27:"FAILWITH",28:"GE",29:"GET","2A":"GT","2B":"HASH_KEY","2C":"IF","2D":"IF_CONS","2E":"IF_LEFT","2F":"IF_NONE",30:"INT",31:"LAMBDA",32:"LE",33:"LEFT",34:"LOOP",35:"LSL",36:"LSR",37:"LT",38:"MAP",39:"MEM","3A":"MUL","3B":"NEG","3C":"NEQ","3D":"NIL","3E":"NONE","3F":"NOT",40:"NOW",41:"OR",42:"PAIR",43:"PUSH",44:"RIGHT",45:"SIZE",46:"SOME",47:"SOURCE",48:"SENDER",49:"SELF","4A":"STEPS_TO_QUOTA","4B":"SUB","4C":"SWAP","4D":"TRANSFER_TOKENS","4E":"SET_DELEGATE","4F":"UNIT",50:"UPDATE",51:"XOR",52:"ITER",53:"LOOP_LEFT",54:"ADDRESS",55:"CONTRACT",56:"ISNAT",57:"CAST",58:"RENAME",59:"bool","5A":"contract","5B":"int","5C":"key","5D":"key_hash","5E":"lambda","5F":"list",60:"map",61:"big_map",62:"nat",63:"option",64:"or",65:"pair",66:"set",67:"signature",68:"string",69:"bytes","6A":"mutez","6B":"timestamp","6C":"unit","6D":"operation","6E":"address","6F":"SLICE"},ee=(n={},Object.keys($).forEach(function(e){n[$[e]]=e}),n),re={opMapping:$,opMappingReverse:ee,primMapping:{"00":"int","01":"string","02":"seq","03":{name:"prim",len:0,annots:!1},"04":{name:"prim",len:0,annots:!0},"05":{name:"prim",len:1,annots:!1},"06":{name:"prim",len:1,annots:!0},"07":{name:"prim",len:2,annots:!1},"08":{name:"prim",len:2,annots:!0},"09":{name:"prim",len:3,annots:!0},"0A":"bytes"},primMappingReverse:{0:{false:"03",true:"04"},1:{false:"05",true:"06"},2:{false:"07",true:"08"},3:{true:"09"}},forgeOpTags:{endorsement:0,seed_nonce_revelation:1,double_endorsement_evidence:2,double_baking_evidence:3,activate_account:4,proposals:5,ballot:6,reveal:7,transaction:8,origination:9,delegation:10}},te={prefix:X,watermark:Z,forgeMappings:re},ne=function(){function e(r,t,n){var a=this;d()(this,e),S()(this,"_curve",void 0),S()(this,"_publicKey",void 0),S()(this,"_secretKey",void 0),S()(this,"_isSecret",void 0),S()(this,"_isLedger",void 0),S()(this,"_ledgerPath",void 0),S()(this,"_ledgerCurve",void 0),S()(this,"ready",void 0),S()(this,"publicKey",function(){return J.b58cencode(a._publicKey,X["".concat(a._curve,"pk")])}),S()(this,"secretKey",function(){if(!a._secretKey)throw new Error("Secret key not known.");var e=a._secretKey;if("ed"===a._curve){var r=U.a.crypto_sign_seed_keypair(e.slice(0,32)).privateKey;e=M()(r)}return J.b58cencode(e,X["".concat(a._curve,"sk")])}),S()(this,"publicKeyHash",function(){var e={ed:X.tz1,sp:X.tz2,p2:X.tz3}[a._curve];return J.b58cencode(U.a.crypto_generichash(20,a._publicKey),e)}),S()(this,"initialize",function(){var e=f()(u.a.mark(function e(r,t,n,i){var o,c,s,p,f,l,d,h,g,b,v,y,k,m;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.a.ready;case 2:if(!n){e.next=14;break}if(t){e.next=5;break}throw new Error("Fundraiser key provided without a passphrase.");case 5:return o=J.textDecode(J.textEncode("".concat(n).concat(t))).normalize("NFKD"),c=I.a.pbkdf2Sync(r,"mnemonic".concat(o),2048,64,"sha512"),s=U.a.crypto_sign_seed_keypair(c.slice(0,32)),p=s.publicKey,f=s.privateKey,a._publicKey=M()(p),a._secretKey=M()(f),a._curve="ed",a._isSecret=!0,i(),e.abrupt("return");case 14:if(a._curve=r.substr(0,2),["sp","p2","ed"].includes(a._curve)){e.next=17;break}throw new Error("Invalid prefix for a key encoding.");case 17:if([54,55,88,98].includes(r.length)){e.next=19;break}throw new Error("Invalid length for a key encoding");case 19:if(l="e"===r.substring(2,3),d=l?r.slice(3,5):r.slice(2,4),["pk","sk"].includes(d)){e.next=23;break}throw new Error("Invalid prefix for a key encoding.");case 23:if(a._isSecret="sk"===d,h=a._isSecret?J.b58cdecode(r,X["".concat(a._curve).concat(l?"e":"","sk")]):J.b58cdecode(r,X["".concat(a._curve,"pk")]),!l){e.next=32;break}if(t){e.next=28;break}throw new Error("Encrypted key provided without a passphrase.");case 28:g=M()(h.slice(0,8)),b=h.slice(8),v=I.a.pbkdf2Sync(t,g,32768,32,"sha512"),h=U.a.crypto_secretbox_open_easy(b,new Uint8Array(24),v);case 32:if(a._isSecret){e.next=37;break}a._publicKey=M()(h),a._secretKey=void 0,e.next=51;break;case 37:if(a._secretKey=M()(h),"ed"!==a._curve){e.next=42;break}64===h.length?a._publicKey=M()(h.slice(32)):(y=U.a.crypto_sign_seed_keypair(h,"uint8array"),k=y.publicKey,m=y.privateKey,a._publicKey=M()(k),a._secretKey=M()(m)),e.next=51;break;case 42:if("sp"!==a._curve){e.next=46;break}a._publicKey=L.a.publicKeyCreate(M()(h)),e.next=51;break;case 46:if("p2"!==a._curve){e.next=50;break}a._publicKey=F.a.publicKeyCreate(M()(h)),e.next=51;break;case 50:throw new Error("Invalid key");case 51:i();case 52:case"end":return e.stop()}},e)}));return function(r,t,n,a){return e.apply(this,arguments)}}()),S()(this,"sign",function(){var e=f()(u.a.mark(function e(r,t){var n,i,o,c,s,p,f,l,d,h,g,b,v;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=J.hex2buf(r),void 0!==t&&(n=J.mergebuf(t,n)),i=M()(U.a.crypto_generichash(32,n)),a._secretKey){e.next=5;break}throw new Error("Cannot sign operations without a secret key.");case 5:if("ed"!==a._curve){e.next=12;break}return o=U.a.crypto_sign_detached(i,a._secretKey),c=M()(o),s=r+J.buf2hex(c),e.abrupt("return",{bytes:r,sig:J.b58cencode(o,X.sig),prefixSig:J.b58cencode(o,X.edsig),sbytes:s});case 12:if("sp"!==a._curve){e.next=19;break}return p=L.a.sign(i,a._secretKey),f=p.signature,l=M()(f),d=r+J.buf2hex(l),e.abrupt("return",{bytes:r,sig:J.b58cencode(f,X.sig),prefixSig:J.b58cencode(f,X.spsig),sbytes:d});case 19:if("p2"!==a._curve){e.next=24;break}return h=F.a.sign(i,a._secretKey),g=h.signature,b=M()(g),v=r+J.buf2hex(b),e.abrupt("return",{bytes:r,sig:J.b58cencode(g,X.sig),prefixSig:J.b58cencode(g,X.p2sig),sbytes:v});case 24:throw new Error("Provided curve not supported");case 25:case"end":return e.stop()}},e)}));return function(r,t){return e.apply(this,arguments)}}()),S()(this,"verify",function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.publicKey();if(!t)throw new Error("Cannot verify without a public key");var n=M()(J.b58cdecode(t,X["".concat(a._curve,"pk")]));if("sig"!==r.slice(0,3)&&a._curve!==r.slice(0,2))throw new Error("Signature and public key curves mismatch.");var i=M()(J.hex2buf(e)),o=M()(J.textEncode(r));if("ed"!==a._curve){if("sp"===a._curve)return L.a.verify(i,o,n);if("p2"===a._curve)return F.a.verify(i,o,n);throw new Error("Curve '".concat(a._curve,"' not supported"))}try{return U.a.crypto_sign_verify_detached(o,i,n)}catch(e){throw new Error("Signature is invalid.")}}),this._isLedger=!1,this._ledgerPath="44'/1729'/0'/0'",this._ledgerCurve=0,this.ready=new Promise(function(e){a.initialize(r,t,n,e)})}return g()(e,[{key:"curve",get:function(){return this._curve}},{key:"isLedger",get:function(){return this._isLedger},set:function(e){this._isLedger=e}},{key:"ledgerPath",get:function(){return this._ledgerPath},set:function(e){this._ledgerPath=e}},{key:"ledgerCurve",get:function(){return this._ledgerCurve},set:function(e){this._ledgerCurve=e}}]),e}(),ae=function(e){return e=parseInt(e,10),new Uint8Array([(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]).buffer},ie=function(e){var r=M()(ae(e));return J.buf2hex(r)},oe=function(e){return e?"ff":"00"},ce=function(e){var r=he(e.code).toLowerCase(),t=he(e.storage).toLowerCase();return ie(r.length/2)+r+ie(t.length/2)+t},se=function(e){var r=he(e).toLowerCase();return ie(r.length/2)+r},ue=function(e){var r=parseInt(e.substr(2,1),10),t="0".concat(r-1),n=M()(J.b58cdecode(e,X[e.substr(0,3)]));return t+=J.buf2hex(n)},pe=function(e,r){var t="";if("K"===e.substr(0,1)){t+="zero"===r?"":"01";var n=M()(J.b58cdecode(e,X.KT));t+=J.buf2hex(n),t+="00"}else t+="zero"===r?"":"00",t+=ue(e);return t},fe=function(e){var r="",t=parseInt(e,10);if(Number.isNaN(t))throw new TypeError("Error forging zarith ".concat(e));for(;;){if(t<128){t<16&&(r+="0"),r+=t.toString(16);break}var n=t%128;t-=n,t/=128,r+=(n+=128).toString(16)}return r},le=function(e){var r="";switch(e.substr(0,2)){case"ed":r="00";break;case"sp":r="01";break;case"p2":r="02"}var t=M()(J.b58cdecode(e,X[e.substr(0,4)]));return r+=J.buf2hex(t)},de=function(e,r){var t="",n=M()(new Uint8Array([re.forgeOpTags[e.kind]]));switch(t=J.buf2hex(n),re.forgeOpTags[e.kind]){case 0:case 1:var a=M()(ae(e.level));if(t+=J.buf2hex(a),0===re.forgeOpTags[e.kind])break;if(t+=e.nonce,1===re.forgeOpTags[e.kind])break;case 2:case 3:throw new Error("Double bake and double endorse forging is not complete");case 4:var i=M()(J.b58cdecode(e.pkh,X.tz1));if(t+=J.buf2hex(i),t+=e.secret,4===re.forgeOpTags[e.kind])break;case 5:case 6:t+=ue(e.source);var o=M()(ae(e.period));if(t+=J.buf2hex(o),5===re.forgeOpTags[e.kind])throw new Error("Proposal forging is not complete");if(6===re.forgeOpTags[e.kind]){var c=M()(J.b58cdecode(e.proposal,X.P));t+=J.buf2hex(c),t+="yay"===e.ballot?"00":"nay"===e.ballot?"01":"02";break}case 7:case 8:case 9:case 10:if(t+=pe(e.source,r),t+=fe(e.fee),t+=fe(e.counter),t+=fe(e.gas_limit),t+=fe(e.storage_limit),7===re.forgeOpTags[e.kind])t+=le(e.public_key);else if(8===re.forgeOpTags[e.kind])t+=fe(e.amount),t+=pe(e.destination),void 0!==e.parameters&&e.parameters?(t+=oe(!0),t+=se(e.parameters)):t+=oe(!1);else if(9===re.forgeOpTags[e.kind]){var s=e.manager_pubkey||e.managerPubkey;t+=ue(s),t+=fe(e.balance),t+=oe(e.spendable),t+=oe(e.delegatable),void 0!==e.delegate&&e.delegate?(t+=oe(!0),t+=ue(e.delegate)):t+=oe(!1),void 0!==e.script&&e.script?(t+=oe(!0),t+=ce(e.script)):t+=oe(!1)}else 10===re.forgeOpTags[e.kind]&&(void 0!==e.delegate&&e.delegate?(t+=oe(!0),t+=ue(e.delegate)):t+=oe(!1))}return t},he=function(e){return function e(r){var t=[];if(r instanceof Array){t.push("02");var n=r.map(function(r){return e(r)}).join(""),a=n.length/2;t.push(a.toString(16).padStart(8,"0")),t.push(n)}else if(r instanceof Object)if(r.prim){var i=r.args?r.args.length:0;if(t.push(re.primMappingReverse[i]["".concat(!!r.annots)]),t.push(re.opMappingReverse[r.prim]),r.args&&r.args.forEach(function(r){return t.push(e(r))}),r.annots){var o=r.annots.map(function(e){var r=M()(J.textEncode(e));return J.buf2hex(r)}).join("20");t.push((o.length/2).toString(16).padStart(8,"0")),t.push(o)}}else if(r.bytes){var c=r.bytes.length/2;t.push("0A"),t.push(c.toString(16).padStart(8,"0")),t.push(r.bytes)}else if(r.int){var s,u=new R.BigNumber(r.int,10),p="-"===u.toString(2)[0]?"1":"0",f=u.toString(2).replace("-","");s=f.length<=6?6:(f.length-6)%7?(f.length+7-(f.length-6))%7:f.length;var l=f.padStart(s,"0").match(/\d{6,7}/g).reverse();l[0]=p+l[0];var d=l.map(function(e,r){return parseInt((r===l.length-1?"0":"1")+e,2).toString(16).padStart(2,"0")}).join("");t.push("00"),t.push(d)}else if(r.string){var h=J.textEncode(r.string),g=[].slice.call(h).map(function(e){return e.toString(16).padStart(2,"0")}).join(""),b=h.length;t.push("01"),t.push(b.toString(16).padStart(8,"0")),t.push(g)}return t.join("")}(e).toUpperCase()},ge={address:pe,decodeRawBytes:function(e){e=e.toUpperCase();var r=0,t=function(t){return e.slice(r,r+t)};return function e(){var n=t(2),a=re.primMapping[n];if(a instanceof Object){r+=2;var i=re.opMapping[t(2)];r+=2;var o={prim:i,args:c()(Array(a.len)).map(function(){return e()}),annots:void 0};if(a.len||delete o.args,a.annots){var s=2*parseInt(t(8),16);r+=8;var u=t(s).match(/[\dA-F]{2}/g);if(r+=s,u){var p=new Uint8Array(u.map(function(e){return parseInt(e,16)})),f=J.textDecode(p);o.annots=f.split(" ")}}else delete o.annots;return o}if("0A"===n){r+=2;var l=t(8);r+=8;var d=2*parseInt(l,16),h=t(d);return r+=d,{bytes:h}}if("01"===n){r+=2;var g=t(8);r+=8;var b=2*parseInt(g,16),v=t(b);r+=b;var y=v.match(/[\dA-F]{2}/g);if(y instanceof Array){var k=new Uint8Array(y.map(function(e){return parseInt(e,16)}));return{string:J.textDecode(k)}}throw new Error("Input bytes error")}if("00"===n){r+=2;var m=parseInt(t(2),16).toString(2).padStart(8,"0");r+=2;for(var _=[m.slice(2)],w="1"===m[0];w;){var x=parseInt(t(2),16).toString(2).padStart(8,"0");r+=2,_.push(x.slice(1)),w="1"===x[0]}return{int:new R.BigNumber(_.reverse().join(""),2).toString()}}if("02"===n){r+=2;var A=t(8);r+=8;for(var E=2*parseInt(A,16),O=r+E,S=[];O>r;)S.push(e());return S}throw new Error("Invalid raw bytes: Byte:".concat(n," Index:").concat(r))}()},encodeRawBytes:he,forge:function(){var e=f()(u.a.mark(function e(r,t,n){var a,i;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.contents){e.next=2;break}throw new Error("No operation contents provided.");case 2:if(r.branch){e.next=4;break}throw new Error("No operation branch provided.");case 4:return a=M()(J.b58cdecode(r.branch,X.b)),i=J.buf2hex(a),r.contents.forEach(function(e){i+=de(e,n)}),e.abrupt("return",{opbytes:i,opOb:r,counter:t});case 8:case"end":return e.stop()}},e)}));return function(r,t,n){return e.apply(this,arguments)}}(),op:de,parameters:se,publicKey:le,publicKeyHash:ue,zarith:fe,bool:oe,script:ce,toBytesInt32:ae,toBytesInt32Hex:ie},be=t(23),ve=t.n(be);function ye(e){var r=[];return e.split("/").forEach(function(e){var t=parseInt(e,10);Number.isNaN(t)||(e.length>1&&"'"===e[e.length-1]&&(t+=2147483648),r.push(t))}),r}function ke(e,r){return Promise.resolve().then(function(){return function e(t,n,a){return t>=n.length?a:r(n[t],t).then(function(r){return a.push(r),e(t+1,n,a)})}(0,e,[])})}var me=function(e){switch(e){case 0:return Buffer.of(13,15,37,217);case 1:return Buffer.of(3,254,226,86);case 2:return Buffer.of(3,178,139,127);default:return Buffer.of(0)}},_e=function(e){switch(e){case 0:return Buffer.of(6,161,159);case 1:return Buffer.of(6,161,161);case 2:return Buffer.of(6,161,164);default:return Buffer.of(0)}},we=function(e,r){return e=function(e,r){switch(r){case 0:return(e=e.slice(0))[0]=r,e;case 1:case 2:return Buffer.concat([Buffer.of(r,2+(1&e[64])),e.slice(1,33)]);default:return Buffer.of(0)}}(e,r),{publicKey:xe(e),address:Ae(e)}},xe=function(e){var r=e[0],t=e.slice(1);return D.a.encode(Buffer.concat([me(r),t]))},Ae=function(e){var r=e[0],t=e.slice(1),n=ve()(20);return n.update(t),n.digest(n=Buffer.alloc(20)),D.a.encode(Buffer.concat([_e(r),n]))},Ee=function(){function e(r){d()(this,e),S()(this,"transport",void 0),this.transport=r,r.decorateAppAPIMethods(this,["getAddress","signOperation","getVersion"],"XTZ")}return g()(e,[{key:"getAddress",value:function(e,r,t){var n=ye(e);t=t||0;var a=Buffer.alloc(1+4*n.length);return a[0]=n.length,n.forEach(function(e,r){a.writeUInt32BE(e,1+4*r)}),this.transport.send(128,r?3:2,0,t,a).then(function(e){var r=e[0],n=e.slice(1,1+r);return we(n,t)})}},{key:"signOperation",value:function(e,r,t){var n,a=this,i=ye(e),o=0,c=Buffer.from(r,"hex"),s=[];t=t||0;var u=Buffer.alloc(4*i.length+1);for(u[0]=i.length,i.forEach(function(e,r){u.writeUInt32BE(e,1+4*r)}),s.push(u);o!==c.length;){var p=void 0;p=o+255>=c.length?c.length-o:255;var f=Buffer.alloc(p);c.copy(f,0,o,o+p),s.push(f),o+=p}return ke(s,function(e,r){var i=1;return 0===r?i=0:r===s.length-1&&(i=129),a.transport.send(128,4,i,t,e).then(function(e){n=e})}).then(function(){return{signature:n.slice(0,n.length-2).toString("hex")}})}},{key:"getVersion",value:function(){return this.transport.send(128,0,0,0,Buffer.alloc(0)).then(function(e){var r=1===e[0];return{major:e[1],minor:e[2],patch:e[3],bakingApp:r}})}}]),e}(),Oe=t(15),Se=t.n(Oe),Te={getAddress:function(){var e=f()(u.a.mark(function e(){var r,t,n,a,i,o,c,s,p,f,l=arguments;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>0&&void 0!==l[0]?l[0]:{},t=r.path,n=void 0===t?"44'/1729'/0'/0'":t,a=r.displayConfirm,i=void 0===a||a,o=r.curve,c=void 0===o?0:o,e.next=3,Se.a.create();case 3:return s=e.sent,p=new Ee(s),e.prev=5,e.next=8,p.getAddress(n,i,c);case 8:f=e.sent,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),s.close(),e.t0;case 15:return s.close(),e.abrupt("return",f);case 17:case"end":return e.stop()}},e,null,[[5,11]])}));return function(){return e.apply(this,arguments)}}(),signOperation:function(){var e=f()(u.a.mark(function e(r){var t,n,a,i,o,c,s,p,f;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.path,n=void 0===t?"44'/1729'/0'/0'":t,a=r.rawTxHex,i=r.curve,o=void 0===i?0:i,e.next=3,Se.a.create();case 3:return c=e.sent,s=new Ee(c),e.prev=5,e.next=8,s.signOperation(n,"03".concat(a),o);case 8:f=e.sent,p=f.signature,e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(5),c.close(),e.abrupt("return",e.t0);case 16:return c.close(),e.abrupt("return",p);case 18:case"end":return e.stop()}},e,null,[[5,12]])}));return function(r){return e.apply(this,arguments)}}(),getVersion:function(){var e=f()(u.a.mark(function e(){var r,t,n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Se.a.create();case 2:return r=e.sent,t=new Ee(r),e.prev=4,e.next=7,t.getVersion();case 7:n=e.sent,e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(4),r.close(),e.abrupt("return",e.t0);case 14:return r.close(),e.abrupt("return",n);case 16:case"end":return e.stop()}},e,null,[[4,10]])}));return function(){return e.apply(this,arguments)}}()};function Ce(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function Pe(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Ce(t,!0).forEach(function(r){S()(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ce(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var Ke=function(e){function r(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http://127.0.0.1:8732",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"main",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return d()(this,r),e=v()(this,_()(r).call(this,t,n,a,o)),S()(k()(e),"_localForge",void 0),S()(k()(e),"_validateLocalForge",void 0),S()(k()(e),"_counters",void 0),S()(k()(e),"_debugMode",void 0),S()(k()(e),"key",void 0),S()(k()(e),"importKey",function(){var r=f()(u.a.mark(function r(t,n,a){return u.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e.key=new ne(t,n,a),r.next=3,e.key.ready;case 3:case"end":return r.stop()}},r)}));return function(e,t,n){return r.apply(this,arguments)}}()),S()(k()(e),"importLedger",f()(u.a.mark(function r(){var t,n,a,i,o=arguments;return u.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:"44'/1729'/0'/0'",0===(n=o.length>1&&void 0!==o[1]?o[1]:0)){r.next=4;break}throw new Error("Only ed25519 curve (0x00) is supported for ledger at the moment.");case 4:return r.next=6,Te.getAddress({path:t,displayConfirm:!0,curve:n});case 6:return a=r.sent,i=a.publicKey,e.key=new ne(i),r.next=11,e.key.ready;case 11:e.key&&(e.key.isLedger=!0,e.key.ledgerPath=t,e.key.ledgerCurve=n);case 12:case"end":return r.stop()}},r)}))),S()(k()(e),"query",function(r,t,n){return void 0===t?void 0===n?n="GET":t={}:void 0===n&&(n="POST"),new Promise(function(a,i){try{var o=new C.a;o.open(n,e.provider+r,!0),o.onload=function(){if(e._debugMode&&console.log("Node call:",r,t),200===o.status)if(o.responseText){var n=JSON.parse(o.responseText);e._debugMode&&console.log("Node response:",r,n),n&&void 0!==n.error?i(n.error):(n&&void 0!==n.ok&&(n=n.ok),a(n))}else i("Empty response returned");else o.responseText?i(o.responseText):i(o.statusText)},o.onerror=function(){i(o.statusText)},"POST"===n?(o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(t))):o.send()}catch(e){i(e)}})}),S()(k()(e),"account",function(){var r=f()(u.a.mark(function r(t){var n,a,i,o,c,s,p,f,l,d,h,g,b;return u.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.balance,a=t.spendable,i=t.delegatable,o=t.delegate,c=t.fee,s=void 0===c?e.defaultFee:c,p=t.gasLimit,f=void 0===p?10600:p,l=t.storageLimit,d=void 0===l?257:l,h={},void 0!==a&&(h.spendable=a),void 0!==i&&(h.delegatable=i),void 0!==o&&o&&(h.delegate=o),g="zero"===e.network?"managerPubkey":"manager_pubkey",b=[Pe(S()({kind:"origination",balance:J.mutez(n),fee:s,gas_limit:f,storage_limit:d},g,e.key.publicKeyHash()),h)],r.abrupt("return",e.sendOperation({operation:b}));case 8:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}()),S()(k()(e),"getBalance",function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/contracts/").concat(r,"/balance"))}),S()(k()(e),"getDelegate",function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/contracts/").concat(r,"/delegate")).then(function(e){return e||!1})}),S()(k()(e),"getManager",function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/contracts/").concat(r,"/manager_key"))}),S()(k()(e),"getCounter",function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/contracts/").concat(r,"/counter"))}),S()(k()(e),"getBaker",function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/context/delegates/").concat(r))}),S()(k()(e),"getHeader",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/header"))}),S()(k()(e),"getHead",function(){return e.query("/chains/".concat(e.chain,"/blocks/head"))}),S()(k()(e),"getHeadHash",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/hash"))}),S()(k()(e),"getBallotList",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/ballot_list"))}),S()(k()(e),"getProposals",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/proposals"))}),S()(k()(e),"getBallots",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/ballots"))}),S()(k()(e),"getListings",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/listings"))}),S()(k()(e),"getCurrentProposal",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/current_proposal"))}),S()(k()(e),"getCurrentPeriod",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/current_period_kind"))}),S()(k()(e),"getCurrentQuorum",function(){return e.query("/chains/".concat(e.chain,"/blocks/head/votes/current_quorum"))}),S()(k()(e),"awaitOperation",function(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:180;if(n<=0)throw new Error("Timeout must be more than 0");if(t<=0)throw new Error("Interval must be more than 0");var a=Math.ceil(n/t)+1,i=0,o=!1,c=function(e){e.hash===r&&(o=!0)};return new Promise(function(r,n){!function s(){return e.getHead().then(function(e){i++;for(var u=3;u>=0;u--)e.operations[u].forEach(c);o?r(e.hash):i>=a?n(new Error("Timeout")):setTimeout(s,1e3*t)})}()})}),S()(k()(e),"call",function(r,t){return e.query(r,t)}),S()(k()(e),"prepareOperation",function(r){var t,n,a=r.operation,o=r.source,s={},p=[],l=!1,d=[];p.push(e.getHeader()),d=Array.isArray(a)?c()(a):[a];for(var h=o||e.key.publicKeyHash(),g=0;g<d.length;g++)if(["transaction","origination","delegation"].includes(d[g].kind)){l=!0,p.push(e.getCounter(h)),p.push(e.getManager(h));break}return Promise.all(p).then(function(){var r=f()(u.a.mark(function r(a){var o,c,p,f,g,b,v,y,k;return u.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(o=i()(a,3),c=o[0],p=o[1],f=o[2],n=c,g="zero"===e.network?f:f.key,l&&!g&&(b={kind:"reveal",fee:1420,public_key:e.key.publicKey(),source:h,gas_limit:10600,storage_limit:300},d.unshift(b)),t=parseInt(p,10),(!e._counters[h]||e._counters[h]<t)&&(e._counters[h]=t),v=function(r){return r.map(function(r){var t=Pe({},r);if(["proposals","ballot","transaction","origination","delegation"].includes(r.kind)&&void 0===r.source&&(t.source=h),["reveal","transaction","origination","delegation"].includes(r.kind)){void 0===r.fee?t.fee="0":t.fee="".concat(r.fee),void 0===r.gas_limit?t.gas_limit="0":t.gas_limit="".concat(r.gas_limit),void 0===r.storage_limit?t.storage_limit="0":t.storage_limit="".concat(r.storage_limit),void 0!==r.balance&&(t.balance="".concat(t.balance)),void 0!==r.amount&&(t.amount="".concat(t.amount));var n=++e._counters[h];t.counter="".concat(n)}return t})},s.branch=n.hash,s.contents=v(d),y="",e._localForge&&!e._validateLocalForge){r.next=14;break}return r.next=13,e.query("/chains/".concat(e.chain,"/blocks/").concat(n.hash,"/helpers/forge/operations"),s);case 13:y=r.sent;case 14:if(s.protocol=n.protocol,e._localForge){r.next=17;break}return r.abrupt("return",{opbytes:y,opOb:s,counter:t});case 17:return r.next=19,ge.forge(s,t,e.network);case 19:if(k=r.sent,!e._validateLocalForge){r.next=24;break}if(k.opbytes!==y){r.next=23;break}return r.abrupt("return",k);case 23:throw new Error("Forge validation error - local and remote bytes don't match");case 24:return r.abrupt("return",Pe({},k,{counter:t}));case 25:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}())}),S()(k()(e),"simulateOperation",function(r){var t=r.operation,n=r.source;return e.prepareOperation({operation:t,source:n}).then(function(r){return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/run_operation"),r.opOb)})}),S()(k()(e),"sendOperation",function(){var r=f()(u.a.mark(function r(t){var n,a,i,o,c,s,p,f,l,d,h,g;return u.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.operation,a=t.source,i=t.skipPrevalidation,o=void 0!==i&&i,c=t.skipSignature,s=void 0!==c&&c,r.next=3,e.prepareOperation({operation:n,source:a});case 3:if(p=r.sent,!e.key.isLedger){r.next=14;break}return r.next=7,Te.signOperation({path:e.key.ledgerPath,rawTxHex:p.opbytes,curve:e.key.ledgerCurve});case 7:f=r.sent,l=J.hex2buf(f),d=J.b58cencode(l,X["".concat(e.key.curve,"sig")]),p.opbytes+=f,p.opOb.signature=d,r.next=24;break;case 14:if(!s){r.next=19;break}p.opbytes+="00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",p.opOb.signature="edsigtXomBKi5CTRf5cjATJWSyaRvhfYNHqSUGrn4SdbYRcGwQrUGjzEfQDTuqHhuA8b2d8NarZjz8TRf65WkpQmo423BtomS8Q",r.next=24;break;case 19:return r.next=21,e.key.sign(p.opbytes,Z.generic);case 21:h=r.sent,p.opbytes=h.sbytes,p.opOb.signature=h.prefixSig;case 24:if(g=a||e.key.publicKeyHash(),!o){r.next=27;break}return r.abrupt("return",e.silentInject(p.opbytes).catch(function(r){throw e._counters[g]=p.counter,r}));case 27:return r.abrupt("return",e.inject(p.opOb,p.opbytes).catch(function(r){throw e._counters[g]=p.counter,r}));case 28:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}()),S()(k()(e),"inject",function(r,t){var n=[],a=[];return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/preapply/operations"),[r]).then(function(r){if(!Array.isArray(r))throw new Error("RPC Fail");for(var i=0;i<r.length;i++)for(var o=0;o<r[i].contents.length;o++)n.push(r[i].contents[o]),void 0!==r[i].contents[o].metadata.operation_result&&"failed"===r[i].contents[o].metadata.operation_result.status&&(a=a.concat(r[i].contents[o].metadata.operation_result.errors));if(a.length)throw new Error(JSON.stringify({error:"Operation Failed",errors:a}));return e.query("/injection/operation",t)}).then(function(e){return{hash:e,operations:n}})}),S()(k()(e),"silentInject",function(r){return e.query("/injection/operation",r).then(function(e){return{hash:e}})}),S()(k()(e),"transfer",function(r){var t=r.to,n=r.source,a=r.amount,i=r.parameter,o=r.fee,c=void 0===o?e.defaultFee:o,s=r.gasLimit,u=void 0===s?10600:s,p=r.storageLimit,f=void 0===p?300:p,l=r.mutez,d=void 0!==l&&l,h=r.rawParam,g=void 0!==h&&h,b={kind:"transaction",fee:c,gas_limit:u,storage_limit:f,amount:d?J.mutez(a):a,destination:t};return i&&(b.parameters=g?i:J.sexp2mic(i)),e.sendOperation({operation:[b],source:n})}),S()(k()(e),"activate",function(r,t){var n={kind:"activate_account",pkh:r,secret:t};return e.sendOperation({operation:[n],skipSignature:!0})}),S()(k()(e),"originate",function(){var r=f()(u.a.mark(function r(t){var n,a,i,o,c,s,p,f,l,d,h,g,b,v,y,k,m,_,w,x;return u.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a=t.balance,i=t.code,o=t.init,c=t.spendable,s=void 0!==c&&c,p=t.delegatable,f=void 0!==p&&p,l=t.delegate,d=t.fee,h=void 0===d?e.defaultFee:d,g=t.gasLimit,b=void 0===g?10600:g,v=t.storageLimit,y=void 0===v?257:v,k=J.ml2mic(i),m={code:k,storage:J.sexp2mic(o)},_="zero"===e.network?"managerPubkey":"manager_pubkey",w=e.key.publicKeyHash(),n={kind:"origination",fee:h,gas_limit:b,storage_limit:y,balance:J.mutez(a)},S()(n,_,w),S()(n,"spendable",s),S()(n,"delegatable",f),S()(n,"script",m),x=n,l&&(x.delegate=l),r.abrupt("return",e.sendOperation({operation:[x]}));case 8:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}()),S()(k()(e),"setDelegate",function(){var r=f()(u.a.mark(function r(t){var n,a,i,o,c,s,p,f,l;return u.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.delegate,a=t.source,i=void 0===a?e.key.publicKeyHash():a,o=t.fee,c=void 0===o?e.defaultFee:o,s=t.gasLimit,p=void 0===s?10600:s,f=t.storageLimit,l={kind:"delegation",source:i,fee:c,gas_limit:p,storage_limit:void 0===f?0:f,delegate:n},r.abrupt("return",e.sendOperation({operation:[l],source:i}));case 3:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}()),S()(k()(e),"registerDelegate",function(){var r=f()(u.a.mark(function r(t){var n,a,i,o,c,s;return u.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.fee,a=void 0===n?e.defaultFee:n,i=t.gasLimit,o=void 0===i?10600:i,c=t.storageLimit,s={kind:"delegation",fee:a,gas_limit:o,storage_limit:void 0===c?0:c,delegate:e.key.publicKeyHash()},r.abrupt("return",e.sendOperation({operation:[s]}));case 3:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}()),S()(k()(e),"typecheckCode",function(r){var t=J.ml2mic(r);return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/typecheck_code"),{program:t,gas:"10000"})}),S()(k()(e),"packData",function(r,t){var n={data:J.sexp2mic(r),type:J.sexp2mic(t),gas:"4000000"};return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/pack_data"),n)}),S()(k()(e),"typecheckData",function(r,t){var n={data:J.sexp2mic(r),type:J.sexp2mic(t),gas:"4000000"};return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/typecheck_data"),n)}),S()(k()(e),"runCode",function(r,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4]?"trace_code":"run_code";return e.query("/chains/".concat(e.chain,"/blocks/head/helpers/scripts/").concat(i),{script:J.ml2mic(r),amount:"".concat(J.mutez(t)),input:J.sexp2mic(n),storage:J.sexp2mic(a)})}),e._localForge=o.localForge||!0,e._validateLocalForge=o.validateLocalForge||!1,e._counters={},e._debugMode=o.debugMode||!1,e}return E()(r,e),g()(r,[{key:"setProvider",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.chain,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.network;x()(_()(r.prototype),"setProvider",this).call(this,e,t,n),this.provider=e,this.chain=t,this.network=n}},{key:"localForge",get:function(){return this._localForge},set:function(e){this._localForge=e}},{key:"validateLocalForge",get:function(){return this._validateLocalForge},set:function(e){this._validateLocalForge=e}},{key:"counters",get:function(){return this._counters},set:function(e){this._counters=e}},{key:"debugMode",get:function(){return this._debugMode},set:function(e){this._debugMode=e}}]),r}(P),Ue=t(17),Be=function(){var e=f()(u.a.mark(function e(r){var t,n,a,i,o,c,s,p,f,l,d,h=arguments;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>1&&void 0!==h[1]?h[1]:"",e.prev=1,e.next=4,U.a.ready;case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),new Error(e.t0);case 9:if(n=U.a,a=r.substr(0,2),[54,55,88,98].includes(r.length)){e.next=13;break}throw new Error("Invalid length for a key encoding");case 13:if(i="e"===r.substring(2,3),"ed"!==a){e.next=30;break}if(!i){e.next=24;break}if(o=M()(J.b58cdecode(r,X.edesk)),c=o.slice(0,8),s=o.slice(8),t){e.next=21;break}throw new Error("No password was provided to decrypt the key");case 21:return p=I.a.pbkdf2Sync(t,c,32768,32,"sha512"),f=n.crypto_sign_seed_keypair(n.crypto_secretbox_open_easy(s,new Uint8Array(24),p)),e.abrupt("return",{sk:J.b58cencode(f.privateKey,X.edsk),pk:J.b58cencode(f.publicKey,X.edpk),pkh:J.b58cencode(n.crypto_generichash(20,f.publicKey),X.tz1)});case 24:if(98!==r.length){e.next=26;break}return e.abrupt("return",{sk:r,pk:J.b58cencode(J.b58cdecode(r,X.edsk).slice(32),X.edpk),pkh:J.b58cencode(n.crypto_generichash(20,J.b58cdecode(r,X.edsk).slice(32)),X.tz1)});case 26:if(54!==r.length){e.next=30;break}return l=J.b58cdecode(r,X.edsk2),d=n.crypto_sign_seed_keypair(l),e.abrupt("return",{sk:J.b58cencode(d.privateKey,X.edsk),pk:J.b58cencode(d.publicKey,X.edpk),pkh:J.b58cencode(n.crypto_generichash(20,d.publicKey),X.tz1)});case 30:return console.error("Invalid prefix for a key encoding"),e.abrupt("return",{sk:"",pk:"",pkh:""});case 32:case"end":return e.stop()}},e,null,[[1,6]])}));return function(r){return e.apply(this,arguments)}}(),Ie=function(){var e=f()(u.a.mark(function e(r,t){var n,a,i;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U.a.ready;case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),new Error(e.t0);case 8:return n=U.a,e.next=11,Object(Ue.mnemonicToSeed)(r,t).then(function(e){return e.slice(0,32)});case 11:return a=e.sent,i=n.crypto_sign_seed_keypair(M()(a)),e.abrupt("return",{mnemonic:r,passphrase:t,sk:J.b58cencode(i.privateKey,X.edsk),pk:J.b58cencode(i.publicKey,X.edpk),pkh:J.b58cencode(n.crypto_generichash(20,i.publicKey),X.tz1)});case 14:case"end":return e.stop()}},e,null,[[0,5]])}));return function(r,t){return e.apply(this,arguments)}}(),qe=function(){var e=f()(u.a.mark(function e(r,t,n){var a,i,o,c,s,p,f,l,d=arguments;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=d.length>3&&void 0!==d[3]?d[3]:"",e.prev=1,e.next=4,U.a.ready;case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),new Error(e.t0);case 9:if(i=U.a,54!==t.length&&55!==t.length){e.next=21;break}return e.prev=11,e.next=14,Be(t,a);case 14:o=e.sent,t=o.sk,e.next=21;break;case 18:throw e.prev=18,e.t1=e.catch(11),new Error(e.t1);case 21:return c=J.hex2buf(r),void 0!==n&&(c=J.mergebuf(n,c)),s=i.crypto_sign_detached(i.crypto_generichash(32,c),J.b58cdecode(t,X.edsk),"uint8array"),p=J.b58cencode(s,X.edsig),f=M()(s),l=r+J.buf2hex(f),e.abrupt("return",{bytes:r,sig:J.b58cencode(s,X.sig),prefixSig:p,sbytes:l});case 28:case"end":return e.stop()}},e,null,[[1,6],[11,18]])}));return function(r,t,n){return e.apply(this,arguments)}}(),Le={extractKeys:Be,generateKeys:Ie,checkAddress:function(e){try{return J.b58cdecode(e,X.tz1),!0}catch(e){return!1}},generateMnemonic:function(){return Object(Ue.generateMnemonic)(160)},sign:qe,verify:function(){var e=f()(u.a.mark(function e(r,t,n){var a,i,o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U.a.ready;case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),new Error(e.t0);case 8:return a=U.a,i=M()(J.hex2buf(r)),o=M()(J.textEncode(t)),e.abrupt("return",a.crypto_sign_verify_detached(o,i,J.b58cdecode(n,X.edpk)));case 12:case"end":return e.stop()}},e,null,[[0,5]])}));return function(r,t,n){return e.apply(this,arguments)}}()};t.d(r,"Key",function(){return ne}),t.d(r,"crypto",function(){return Le}),t.d(r,"forge",function(){return ge}),t.d(r,"utility",function(){return J}),t.d(r,"ledger",function(){return Te}),t.d(r,"constants",function(){return te});r.default=Ke}])});